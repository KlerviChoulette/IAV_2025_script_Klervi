ggplot(res_specialisation$Ifinal,
aes(x = as.numeric(year), y = LPI_final)) +
geom_line(data = res_specialisation$leverage,
aes(x = as.numeric(year), y = LPI, group = binomial), color = "grey", linewidth = 1, alpha = 0.4)+
geom_line(aes(color = specialisation),linewidth = 1.3)+
geom_ribbon(aes(ymin = IC_low, ymax = IC_high, fill = specialisation), alpha = 0.1)+
geom_hline(yintercept = 1)+
labs(x = "Année", y = "IAV (2002 = 1)")+
scale_x_continuous(breaks = seq(2002, 2024, by = 2))+
scale_color_manual(values = color_gene, name = NULL)+
scale_fill_manual(values = color_gene, name = NULL)+
facet_wrap(~specialisation,# scales = "free_y",
labeller = labeller(
specialisation = c(
gene = paste("Généraliste (", res_specialisation$nb_sp_max$gene, " espèces)", sep = "" ),
spe =  paste("Spécialiste (", res_specialisation$nb_sp_max$spe, " espèces)", sep = "" )
)))+
theme_bw()+
theme(legend.position = "none")
res_cavicole <- calcul_indicateur(
data = data_nicheur_clean,
var_groupe = "cavicole",
data_SpeciesLambda_2002 = data_SpeciesLambda_2002,
CAP_LAMBDAS = CAP_LAMBDAS,
FinalYear = FinalYear,
InitialYear = InitialYear,
sNames = sNames,
data_all = data_all_nicheur
)
ggplot(res_cavicole$Ifinal,
aes(x = as.numeric(year), y = LPI_final)) +
geom_line(data = res_cavicole$leverage,
aes(x = as.numeric(year), y = LPI, group = binomial), color = "grey", linewidth = 1, alpha = 0.4)+
geom_line(aes(color = cavicole),linewidth = 1.3)+
geom_ribbon(aes(ymin = IC_low, ymax = IC_high, fill = cavicole), alpha = 0.1)+
geom_hline(yintercept = 1)+
labs(x = "Année", y = "IAV (2002 = 1)")+
scale_x_continuous(breaks = seq(2002, 2024, by = 2))+
scale_color_manual(values = color_cavicole, name = NULL)+
scale_fill_manual(values = color_cavicole, name = NULL)+
facet_wrap(~cavicole,# scales = "free_y",
labeller = labeller(
cavicole = c(
oui = paste("Cavicole (", res_cavicole$nb_sp_max$non, " espèces)", sep = "" ),
non =  paste("Non cavicole (", res_cavicole$nb_sp_max$oui, " espèces)", sep = "" ),
semi =  paste("Semi cavicole (", res_cavicole$nb_sp_max$semi, " espèces)", sep = "" )
)))+
theme_bw()+
theme(legend.position = "none"
)
res_colonial <- calcul_indicateur(
data = data_nicheur_clean,
var_groupe = "colonial",
data_SpeciesLambda_2002 = data_SpeciesLambda_2002,
CAP_LAMBDAS = CAP_LAMBDAS,
FinalYear = FinalYear,
InitialYear = InitialYear,
sNames = sNames,
data_all = data_all_nicheur
)
ggplot(res_colonial$Ifinal,
aes(x = as.numeric(year), y = LPI_final)) +
geom_line(data = res_colonial$leverage,
aes(x = as.numeric(year), y = LPI, group = binomial), color = "grey", linewidth = 1, alpha = 0.4)+
geom_line(aes(color = as.factor(colonial)),linewidth = 1.3)+
geom_ribbon(aes(ymin = IC_low, ymax = IC_high, fill = colonial), alpha = 0.1)+
geom_hline(yintercept = 1)+
labs(x = "Année", y = "IAV (2002 = 1)", color = "colonial :")+
scale_x_continuous(breaks = seq(2002, 2024, by = 2))+
#scale_y_continuous(limits = c(0,3.5))+
scale_color_manual(values = color_colonial)+
scale_fill_manual(values = color_colonial)+
facet_wrap(~colonial, #scales = "free_y",
labeller = labeller(
colonial = c(
oui = paste("Colonial (", res_colonial$nb_sp_max$oui, " espèces)", sep = "" ),
non =  paste("Non colonial (", res_colonial$nb_sp_max$non, " espèces)", sep = "" )
)))+
theme_bw()+
theme(legend.position = "none")
res_lrnidif_bfc <- calcul_indicateur(
data = data_nicheur_clean,
var_groupe = "lrnidif_bfc.hypothese",
data_SpeciesLambda_2002 = data_SpeciesLambda_2002,
CAP_LAMBDAS = CAP_LAMBDAS,
FinalYear = FinalYear,
InitialYear = InitialYear,
sNames = sNames,
data_all = data_all_nicheur
)
ggplot(res_lrnidif_bfc$Ifinal,
aes(x = as.numeric(year), y = LPI_final)) +
geom_line(data = res_lrnidif_bfc$leverage,
aes(x = as.numeric(year), y = LPI, group = binomial), color = "grey", linewidth = 1, alpha = 0.4)+
geom_line(aes(color = as.factor(lrnidif_bfc.hypothese)),linewidth = 1.3)+
geom_ribbon(aes(ymin = IC_low, ymax = IC_high, fill =  as.factor(lrnidif_bfc.hypothese)), alpha = 0.1)+
geom_hline(yintercept = 1)+
labs(x = "Année", y = "IAV (2002 = 1)", lrr = "lrnidif_bfc.hypothese :")+
scale_x_continuous(breaks = seq(2002, 2024, by = 2))+
#scale_y_continuous(limits = c(0,1.5))+
scale_color_manual(values = c(cr = "#FF0000",
en = "#FFA500",
vu = "#FFFF00",
lc = "#008000",
nt = "#ADFF2F",
"grey60"))+
scale_fill_manual(values = c(cr = "#FF0000",
en = "#FFA500",
vu = "#FFFF00",
lc = "#008000",
nt = "#ADFF2F",
"grey60"))+
facet_wrap(~lrnidif_bfc.hypothese, ncol = 2,scales = "free_y",
labeller = labeller(
lrnidif_bfc.hypothese = c(
cr = paste("En danger critique (", res_lrnidif_bfc$nb_sp_max$cr, " espèces)", sep = "" ),
dd = paste("Données insuffisantes (", res_lrnidif_bfc$nb_sp_max$dd, " espèces)", sep = "" ),
en = paste("En danger (", res_lrnidif_bfc$nb_sp_max$en, " espèces)", sep = "" ),
lc = paste("Préoccupation mineur (", res_lrnidif_bfc$nb_sp_max$lc, " espèces)", sep = "" ),
nt = paste("Quasi-menacée (", res_lrnidif_bfc$nb_sp_max$nt, " espèces)", sep = "" ),
vu = paste("Vulnérable (", res_lrnidif_bfc$nb_sp_max$vu, " espèces)", sep = "" )
)))+
theme_bw()+
theme(legend.position = "none")
res_statut.protect <- calcul_indicateur(
data = data_nicheur_clean,
var_groupe = "protect_fra",
data_SpeciesLambda_2002 = data_SpeciesLambda_2002,
CAP_LAMBDAS = CAP_LAMBDAS,
FinalYear = FinalYear,
InitialYear = InitialYear,
sNames = sNames,
data_all = data_all_nicheur
)
ggplot(res_statut.protect$Ifinal,
aes(x = as.numeric(year), y = LPI_final)) +
geom_line(data = res_statut.protect$leverage,
aes(x = as.numeric(year), y = LPI, group = binomial), color = "grey", linewidth = 1, alpha = 0.4)+
geom_line(aes(color = as.factor(protect_fra)),linewidth = 1.3)+
geom_ribbon(aes(ymin = IC_low, ymax = IC_high, fill =  as.factor(protect_fra)), alpha = 0.1)+
geom_hline(yintercept = 1)+
labs(x = "Année", y = "IAV (2002 = 1)", protectr = "protect_fra :")+
scale_x_continuous(breaks = seq(2002, 2024, by = 2))+
#scale_y_continuous(limits = c(0,1.5))+
scale_color_manual(values = c("#E88E00","#E760A4","#4472C4","grey56"))+
scale_fill_manual(values = c("#E88E00","#E760A4","#4472C4","grey56"))+
facet_wrap(~protect_fra, ncol = 2, scales = "free_y",
labeller = labeller(
protect_fra = c(
chasse = paste("Espèces chassables (", res_statut.protect$nb_sp_max$chasse, " espèces)", sep = "" ),
`chasse-mor` =  paste("Espèces sous moratoire de chasse (", res_statut.protect$nb_sp_max$`chasse-mor`, " espèces)", sep = "" ),
`esp-biot` = paste("Espèces protégées (", res_statut.protect$nb_sp_max$`esp-biot`, " espèces)", sep = "" ),
na = paste("NA (", res_statut.protect$nb_sp_max$na, " espèces)", sep = "" )
)))+
theme_bw()+
theme(legend.position = "none")
Ifinal_selection_2002_dept = list()
for (departement in unique(data_nicheur_clean$dept)){
data_nicheur_clean_dept = data_nicheur_clean%>%filter(dept == departement)
#Données
Species = data_nicheur_clean_dept["binomial"]
ID = data_nicheur_clean_dept["id"]
Year = data_nicheur_clean_dept["year"]
Popvalue = data_nicheur_clean_dept["popvalue"]
#Paramètrage
REF_YEAR = 2002
LINEAR_MODEL_FLAG = TRUE
CHAIN_MODEL_FLAG = TRUE
MethodFlagLoop = 0
LAMBDA_MAX = 1
LAMBDA_MIN = -1
CAP_LAMBDAS = TRUE
FinalYear = max(Year)
InitialYear = min(Year)
NumberYear = FinalYear - InitialYear +1
noRecs = max(dim(Popvalue))
sNames = unique(pull(Species))
sID = unique(ID)
noSpecies = max(dim(unique(Species)))
noPop = max(dim(unique(ID)))
MethodFlag = matrix(0, 1, noPop)
sNamesCounter = 0
sNamesArray = sNames
sIDArray = sID
asso_SPNames_Number = data.frame(
binomial = sNames,
number = seq_along(sNames),
stringsAsFactors = FALSE
)
PopProcessedGAM = matrix(0, 1, noPop)
#Tableau pour récupérer les données
data_SpeciesLambda_2002_dept = matrix(0, noSpecies, FinalYear - REF_YEAR +
1)
SpeciesLambda = matrix(0, noSpecies, FinalYear - REF_YEAR +
1)
PopPredict = as.data.frame(matrix(ncol = 5+NumberYear+NumberYear)) #Sur 35ans (x2 pour les SE) ET 5 col pour infos suplémentaires
colnames(PopPredict) = c("binomial", "id", "Model", "Model_valide", "Smooth_para",
seq(InitialYear,FinalYear, by = 1), paste(seq(InitialYear,FinalYear, by = 1), "_se", sep = ""))
#variable pour récupérer des infos
nb_pop_year_lambda = rep(0, NumberYear)
nb_sp_year_dtemp = rep(0,  FinalYear - REF_YEAR +1)
compteur = 0
model_used = c()
model_valid_used = c()
cat(sprintf("Number of species: %s (in %s populations)\n",
noSpecies, noPop))
for(I in sNames) {
cat(".")
Index = 1
if (length(which(objects() == "sIndex")) != 0) {
rm(sIndex)
}
SP = toString(sNames[asso_SPNames_Number%>%
filter(binomial == I)%>%
pull(number)])
sIndex = which(Species == SP)
SpeciesIndex = asso_SPNames_Number%>%
filter(binomial == I)%>%
pull(number)
PopID = unique(ID[sIndex, 1])
if (length(which(objects() == "PopLambda")) != 0) {
rm(PopLambda)
}
PopIDSize = length(PopID)
PopLambda = matrix(NA, PopIDSize, FinalYear - REF_YEAR +
1)
JIndex = 1
### Enlever les zéros pour une pop
#choisir la population J de l'espèce I
for (J in 1:PopIDSize) {
compteur = compteur+1
IndexPop = which(ID == PopID[J])
YearPop = Year[IndexPop, 1]
#cat("Espece : ", SP, "Pop :", PopID[J], "\n")
# First_year_pop = YearPop[1]
# Last_year_pop = YearPop[length(YearPop)]
PopN = Popvalue[IndexPop, 1]
if(length(PopN) > 1){
PopN = remove_zero(PopN)
SortResults = sort(YearPop, index.return = TRUE)
YearPop = SortResults$x
TempI = SortResults$ix
PopN = PopN[TempI]
### Vide les variables à utiliser
if (length(which(objects() == "YearPopInt")) !=
0) {
rm(YearPopInt)
}
if (length(which(objects() == "PopNInt")) !=
0) {
rm(PopNInt)
}
if (length(which(objects() == "PopNInt_se")) !=
0) {
rm(PopNInt_se)
}
#Toutes les années entre la première et la dernière valeur
YearPopInt = YearPop[1]:YearPop[length(YearPop)]
PopNLog = log(PopN) # Prendre le log des populations
GAm_Flag = T
if (var(PopN) == 0) {
#cat(sprintf("Variance de PopN = %d\n", var(PopN)))
GAm_Flag = F
}
SmoothParm = round(length(PopN)/2)
### GAM
# Si le Smoothparam est inférieur à 3 alors pas de GAM
if (SmoothParm >= 3 & GAm_Flag == T) {
#cat("GAM_MODEL\n")
res_fit_gam_model = fit_gam_model(SmoothParm, PopNLog, YearPop)
if(!is.null(res_fit_gam_model)){
PopNInt_se = res_fit_gam_model$PopNInt_se
PopNInt = res_fit_gam_model$PopNInt
model_used = c("GAM")
model_valid_used = c("GAM")
PopPredict = bind_rows(PopPredict, c("binomial" = SP, "id"= PopID[J],
"Model" = model_used, "Model_valide" = model_valid_used,"Smooth_para" = SmoothParm,
setNames(c(PopNInt),YearPopInt),
setNames(c(PopNInt_se),
paste(seq(min(YearPopInt),max(YearPopInt), by = 1), "_se", sep = ""))))
}
}
#LINEAR_MODEL_FLAG = readline(prompt = "Press 'TRUE' to LINEAR_MODEL, 'F' to go to CHAIN_MODEL")
# if(LINEAR_MODEL_FLAG == TRUE) {### Sinon pas de GAM
#   #cat("LINEAR_MODEL\n")
#   res_fit_linear_model = fit_linear_model(YearPop, PopNLog)
#   PopNInt_lm = res_fit_linear_model$PopNInt
#   PopNInt_lm_se = res_fit_linear_model$PopNInt_se
#   model_used = c("Linear")
#   PopPredict = bind_rows(PopPredict, c("binomial" = SP, "id"= PopID[J],
#                                        "Model" = model_used,
#                                        setNames(c(PopNInt_lm),YearPopInt),
#                                        setNames(c(PopNInt_lm_se),
#                                                 paste(seq(min(YearPopInt),max(YearPopInt), by = 1), "_se", sep = ""))))
# }
#CHAIN_MODEL_FLAG = readline(prompt = "Press 'TRUE' to CHAIN_MODEL, 'F' ")
if(CHAIN_MODEL_FLAG == TRUE) {
#cat("CHAIN_MODEL\n")
model_used = "Chain_model"
if("GAM" %in% (PopPredict%>%
filter(id == PopID[J])%>%
pull(Model_valide))){
model_used = "Chain_model"
# Apply the default approach (Chain)
PopNInt_chain =  fit_chain_model(YearPopInt, YearPop,PopN)$PopNInt
PopNInt_chain_se = fit_chain_model(YearPopInt, YearPop,PopN)$PopNInt_se
PopPredict = bind_rows(PopPredict, c("binomial" = SP, "id"= PopID[J],
"Model" = model_used,
setNames(c(PopNInt_chain),YearPopInt),
setNames(c(PopNInt_chain_se),
paste(seq(min(YearPopInt),max(YearPopInt), by = 1), "_se", sep = ""))))
}
else {
model_valid_used = "Chain_model"
model_used = "Chain_model"
PopNInt =  fit_chain_model(YearPopInt, YearPop,PopN)$PopNInt
PopNInt_se = fit_chain_model(YearPopInt, YearPop,PopN)$PopNInt_se
PopPredict = bind_rows(PopPredict, c("binomial" = SP, "id"= PopID[J],
"Model" = model_used,
"Model_valide" = model_valid_used,
setNames(c(PopNInt),YearPopInt),
setNames(c(PopNInt_se),
paste(seq(min(YearPopInt),max(YearPopInt), by = 1), "_se", sep = ""))))
}
}
#Enlever les Zeros des prédictions et mettre en log
#Le Living Planet Index (LPI) est souvent calculé sur les moyennes
#géométriques de populations standardisées, et ça se fait bien avec des log.
{
YearPop = InitialYear:FinalYear
PopN = matrix(0, 1, length(YearPop))
k = which(PopNInt == 0)
k1 = which(PopNInt > 0)
TempVal = 0
if (length(k) > 0) {
if (length(k1) > 0) {
TempVal = mean(PopNInt[k1]) * 0.01
PopNInt = PopNInt + TempVal
}
}
for (K in InitialYear:FinalYear) {
k = which(YearPopInt == K)
if (length(k) > 0) {
if (PopNInt[k] == 0) {
PopN[K - InitialYear + 1] = NA
}
else {
#Mettre en Log10 les populations prédites
PopN[K - InitialYear + 1] = log10(PopNInt[k])
}
}
else {
PopN[K - InitialYear + 1] = NA
}
}
}
###### Calculate the growth rate
{
PopLambda = calcul_lambda_pop(PopLambda, JIndex, FinalYear, PopN, InitialYear, REF_YEAR)
JIndex = JIndex + 1
}
#################################################### FIN BOUCLE POPULATION
}
else{
cat("Less than 2 obs for population :", PopID[J], "\n")}
}
# Save the population lamdas to a file:
PopData = cbind(as.vector(PopID), PopLambda)
####################################### Save the species average lambda values
{
res_calcul_lambda_species = calcul_lambda_species(InitialYear = InitialYear,
FinalYear = FinalYear,
PopLambda = PopLambda,
SpeciesIndex = SpeciesIndex,
REF_YEAR = REF_YEAR,
LAMBDA_MAX = LAMBDA_MAX,
LAMBDA_MIN = LAMBDA_MIN)
data_SpeciesLambda_2002_dept[SpeciesIndex,] = res_calcul_lambda_species$SpeciesLambda[SpeciesIndex,]
#nb_pop_year_lambda = nb_pop_year_lambda + res_calcul_lambda_species$nb_pop_year_lambda
}
############################################################ FIN BOUCLE ESPECE
}
closeAllConnections()
#Calcul des Dtemp (le taux de croissance total par année)
results_DTemp = calcul_dtemp(data_SpeciesLambda_2002_dept, CAP_LAMBDAS)
DTemp_2002_dept = results_DTemp$DTemp
nb_sp_year_dtemp = nb_sp_year_dtemp + results_DTemp$nb_sp_year_dtemp
#Paramètre pour le LPI
PLOT_MAX = FinalYear
REF_YEAR = 2002
DSize = PLOT_MAX - REF_YEAR + 1
#Calcul de l'indice à partir des Dtemp
Ifinal = calcul_index(DTemp_2002_dept, DSize, REF_YEAR, InitialYear)
valid_index_years = ((!is.na(Ifinal)) & (Ifinal != -99))
Ifinal = Ifinal%>%
as_tibble()%>%
mutate(LPI_final = V1,
year = REF_YEAR:PLOT_MAX,
Nb_sp_year = nb_sp_year_dtemp)%>%
select(-V1)
#Calcul de l'intervalle de confiance à partir des bootstraps
Ifinal_IC = calcul_IC(BOOT_STRAP_SIZE = 1000, DSize, data_SpeciesLambda_2002_dept,
InitialYear, REF_YEAR)$IC
Ifinal_IC = Ifinal_IC%>%
as_tibble()%>%
rename_with(~ c("IC_low", "IC_high"))%>%
mutate(year = REF_YEAR : PLOT_MAX)
Ifinal_selection_2002_dept[[as.character(departement)]] = left_join(Ifinal, Ifinal_IC, by = join_by(year))
}
Ifinal_all_dept <- bind_rows(
.x = Ifinal_selection_2002_dept,
.id = "dept"
)
ggplot(Ifinal_all_dept,
aes(x =year)) +
geom_line(aes(y = LPI_final, color = dept), size = 1.5) +
geom_ribbon(aes(x = year, ymin = IC_low, ymax = IC_high,fill = dept), alpha = 0.1) +
geom_hline(yintercept = 1, color = "grey")+
scale_color_manual(values = color_dept)+
scale_fill_manual(values = color_dept)+
scale_y_continuous(limits = c(0.5,2))+
scale_x_continuous(breaks = seq(2002, 2024, by = 2))+
facet_wrap(~dept, ncol = 2,
labeller = labeller(
dept = c(
`21` = paste("Côte d'or (21)", "- Nombre d'espèce :", max(Ifinal_all_dept%>%filter(dept == 21)%>%pull(Nb_sp_year))),
`25` =  paste("Doubs (25)", "- Nombre d'espèce :", max(Ifinal_all_dept%>%filter(dept == 25)%>%pull(Nb_sp_year))),
`39` =  paste("Jura (39)", "- Nombre d'espèce :", max(Ifinal_all_dept%>%filter(dept == 39)%>%pull(Nb_sp_year))),
`58` =  paste("Nièvre (58)", "- Nombre d'espèce :", max(Ifinal_all_dept%>%filter(dept == 58)%>%pull(Nb_sp_year))),
`70` =  paste("Haute-Saône (70)", "- Nombre d'espèce :", max(Ifinal_all_dept%>%filter(dept == 70)%>%pull(Nb_sp_year))),
`71` =  paste("Saône et Loire (71)", "- Nombre d'espèce :", max(Ifinal_all_dept%>%filter(dept == 71)%>%pull(Nb_sp_year))),
`89` =  paste("Yonne (89)", "- Nombre d'espèce :", max(Ifinal_all_dept%>%filter(dept == 89)%>%pull(Nb_sp_year))),
`90` =  paste("Territoire de Belfor (90)", "- Nombre d'espèce :", max(Ifinal_all_dept%>%filter(dept == 90)%>%pull(Nb_sp_year)))
)
))+
labs(x = "Année", y = "IAV (2002 = 1)") +
theme_bw()+
theme(legend.position = "none")
ggplot(Ifinal_all_dept,
aes(x =year)) +
geom_line(aes(y = LPI_final, color = dept), size = 1.5) +
geom_ribbon(aes(x = year, ymin = IC_low, ymax = IC_high,fill = dept), alpha = 0.1) +
geom_hline(yintercept = 1, color = "grey")+
scale_color_manual(values = color_dept)+
scale_fill_manual(values = color_dept)+
scale_y_continuous(limits = c(0.5,2))+
scale_x_continuous(breaks = seq(2002, 2024, by = 2))+
labs(x = "Année", y = "IAV (2002 = 1)") +
theme_bw()+
theme(legend.position = "right")
ggplot(res_cavicole$Ifinal,
aes(x = as.numeric(year), y = LPI_final)) +
geom_line(data = res_cavicole$leverage,
aes(x = as.numeric(year), y = LPI, group = binomial), color = "grey", linewidth = 1, alpha = 0.4)+
geom_line(aes(color = cavicole),linewidth = 1.3)+
geom_ribbon(aes(ymin = IC_low, ymax = IC_high, fill = cavicole), alpha = 0.1)+
geom_hline(yintercept = 1)+
labs(x = "Année", y = "IAV (2002 = 1)")+
scale_x_continuous(breaks = seq(2002, 2024, by = 2))+
scale_color_manual(values = color_cavicole, name = NULL)+
scale_fill_manual(values = color_cavicole, name = NULL)+
facet_wrap(~cavicole,ncol = 2, scales = "free_y",
labeller = labeller(
cavicole = c(
oui = paste("Cavicole (", res_cavicole$nb_sp_max$non, " espèces)", sep = "" ),
non =  paste("Non cavicole (", res_cavicole$nb_sp_max$oui, " espèces)", sep = "" ),
semi =  paste("Semi cavicole (", res_cavicole$nb_sp_max$semi, " espèces)", sep = "" )
)))+
theme_bw()+
theme(legend.position = "none"
)
ggplot(res_cavicole$Ifinal,
aes(x = as.numeric(year), y = LPI_final)) +
geom_line(data = res_cavicole$leverage,
aes(x = as.numeric(year), y = LPI, group = binomial), color = "grey", linewidth = 1, alpha = 0.4)+
geom_line(aes(color = cavicole),linewidth = 1.3)+
geom_ribbon(aes(ymin = IC_low, ymax = IC_high, fill = cavicole), alpha = 0.1)+
geom_hline(yintercept = 1)+
labs(x = "Année", y = "IAV (2002 = 1)")+
scale_x_continuous(breaks = seq(2002, 2024, by = 2))+
scale_color_manual(values = color_cavicole, name = NULL)+
scale_fill_manual(values = color_cavicole, name = NULL)+
facet_wrap(~cavicole,ncol = 2, #scales = "free_y",
labeller = labeller(
cavicole = c(
oui = paste("Cavicole (", res_cavicole$nb_sp_max$non, " espèces)", sep = "" ),
non =  paste("Non cavicole (", res_cavicole$nb_sp_max$oui, " espèces)", sep = "" ),
semi =  paste("Semi cavicole (", res_cavicole$nb_sp_max$semi, " espèces)", sep = "" )
)))+
theme_bw()+
theme(legend.position = "none"
)
ggplot(res_colonial$Ifinal,
aes(x = as.numeric(year), y = LPI_final)) +
geom_line(data = res_colonial$leverage,
aes(x = as.numeric(year), y = LPI, group = binomial), color = "grey", linewidth = 1, alpha = 0.4)+
geom_line(aes(color = as.factor(colonial)),linewidth = 1.3)+
geom_ribbon(aes(ymin = IC_low, ymax = IC_high, fill = colonial), alpha = 0.1)+
geom_hline(yintercept = 1)+
labs(x = "Année", y = "IAV (2002 = 1)", color = "colonial :")+
scale_x_continuous(breaks = seq(2002, 2024, by = 2))+
#scale_y_continuous(limits = c(0,3.5))+
scale_color_manual(values = color_colonial)+
scale_fill_manual(values = color_colonial)+
facet_wrap(~colonial, #scales = "free_y",
labeller = labeller(
colonial = c(
oui = paste("Colonial (", res_colonial$nb_sp_max$oui, " espèces)", sep = "" ),
non =  paste("Non colonial (", res_colonial$nb_sp_max$non, " espèces)", sep = "" )
)))+
theme_bw()+
theme(legend.position = "none")
